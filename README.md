# Omnistrate Licensing SDK for Go

![Build](https://github.com/omnistrate-community/licensing-example-go/actions/workflows/build.yml/badge.svg) 
![Package](https://github.com/omnistrate-community/licensing-example-go/actions/workflows/package.yml/badge.svg) 
![CodeQL](https://github.com/omnistrate-community/licensing-example-go/actions/workflows/codeql.yml/badge.svg)

## Overview

This example project demonstrates how to use the Omnistrate Licensing SDK in a GoLang application, with a focus on validating license files generated by Omnistrate. It includes examples of how to integrate the SDK into your GoLang projects and use its validation functions to ensure licenses are valid.

## Description

This project demonstrates how to use the Omnistrate Licensing SDK in a GoLang application. It provides examples of how to integrate licensing features into your GoLang projects, including license generation, validation, and management.

## Installation

To install the necessary dependencies, run:
```sh
go get -u github.com/omnistrate-oss/omnistrate-licensing-sdk-go
```

## Usage

1. Import the SDK into your GoLang project:
    ```go
    import "github.com/omnistrate/licensing-sdk-go"
    ```

2. Initialize the SDK with your configuration:
    ```go
    config := licensing.Config{
        // Your configuration settings
    }
    sdk := licensing.NewSDK(config)
    ```

3. Use the SDK to generate and validate licenses:
    ```go
    license, err := sdk.GenerateLicense(params)
    if err != nil {
        log.Fatal(err)
    }
    valid, err := sdk.ValidateLicense(license)
    if err != nil {
        log.Fatal(err)
    }
    if valid {
        fmt.Println("License is valid")
    } else {
        fmt.Println("License is invalid")
    }
    ```

## Usage Examples

### Pre requisites

The `Licensing` feature needs to be enabled for the service plan. When enabling the feature a product identifier can be optionally configured. That value can then be optionally used to Validate the license. 

Docker compose example: 
```yaml
x-customer-integrations:
  licensing: 
    licenseExpirationInDays: 7 # optional - defaults to 7 days
    productTierSku: '[SKU]' # optional - identifier (shared secret) that can be used to add extra security on validation
```

When used on a Container based resource, Omnistrate takes care of mounting the secret and setting the environment variables for verification. 

Service spec configuration:
```yaml
features:
  licensing:
    licenseExpirationInDays: 7 # optional - defaults to 7 days
    productTierSku: '[SKU]' # optional - identifier (shared secret) that can be used to add extra security on validation
```

When using Helm or Operator the secret `service-plan-subscription-license` generated with the license needs to be mounted on `/var/subscription/`

### ValidateLicense

The validation of the license can be done on startup or periodically and does not require connection to external services to execute. 

```go
package main

import (
	"fmt"
	"github.com/omnistrate-oss/omnistrate-licensing-sdk-go/pkg/validator"
)

func main() {
	err := validator.ValidateLicense()
	if err != nil {
		fmt.Println("License validation failed:", err)
	} else {
		fmt.Println("License validation succeeded")
	}
}
```

### ValidateLicenseForProduct

Alternatively, if a value is set for the `productTierSku` field, this method can be used to add extra security, ensuring the license has the same shared secret. 

```go
package main

import (
	"fmt"
	"github.com/omnistrate-oss/omnistrate-licensing-sdk-go/pkg/validator"
)

func main() {
	err := validator.ValidateLicenseForProduct("product-id")
	if err != nil {
		fmt.Println("License validation for product failed:", err)
	} else {
		fmt.Println("License validation for product succeeded")
	}
}
```

## Examples

Refer to the `examples` directory for complete examples of how to use the SDK in different scenarios.

## Contributing

Want to contribute? Awesome! You can find information about contributing to this project in the [CONTRIBUTING](/CONTRIBUTING.md) page.

## License

This project is licensed under the MIT License. See the LICENSE file for details.

## About Omnistrate

[Omnistrate](https://omnistrate.com/) is the operating system for your SaaS, offering enterprise-grade capabilities: automated provisioning, serverless capabilities, auto-scaling, billing, monitoring, centralized logging, self-healing, intelligent patching and much more!
